<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8" />
  <title>роЪрпКро▓рпН роЕроХро░ро╛родро┐ | Sollagarathi</title>

  <meta name="description" content="родрооро┐ро┤рпН роЪрпКро▒рпНроХро│ро┐ройрпН роЖро┤рооро╛рой рокрпКро░рпБро│рпН, ро╡рпЗро░рпН, роЗро▓роХрпНроХро┐роп роЪро╛ройрпНро▒рпБроХро│рпН тАУ роЪрпКро▓рпН роЕроХро░ро╛родро┐" />
  <meta name="keywords" content="Tamil Dictionary, роЪрпКро▓рпН роЕроХро░ро╛родро┐, родрооро┐ро┤рпН роЕроХро░ро╛родро┐">

  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Tamil&display=swap" rel="stylesheet">

  <style>
    body { font-family:'Noto Serif Tamil', serif; background:#f8f8f8; margin:0; padding:30px; }
    h1,p { text-align:center; }

    input { font-size:20px; padding:10px; width:60%; }
    button { font-size:16px; padding:6px 14px; cursor:pointer; }

    .search-area { text-align:center; }

    .main {
      margin-top:25px;
      display:grid;
      grid-template-columns:260px 1fr;
      gap:15px;
    }

    .left-pane,.right-pane {
      background:#fff;
      border-radius:8px;
      padding:14px;
      box-shadow:0 2px 5px rgba(0,0,0,0.1);
    }

    .left-pane h3 { margin-top:0; font-size:16px; color:#4b2e83; }

    .match-item {
      padding:6px;
      border-bottom:1px solid #eee;
      font-size:15px;
    }

    .box {
      white-space:pre-wrap;
      font-size:18px;
      margin-bottom:15px;
    }

    .title {
      font-weight:bold;
      margin-bottom:6px;
      color:#4b2e83;
    }

    #suggestions span {
      cursor:pointer;
      padding:4px 8px;
      border:1px solid #ccc;
      margin:3px;
      display:inline-block;
      border-radius:4px;
      background:#fff;
    }

    /* Widgets */
    .widgets {
      margin-top:40px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:20px;
      text-align:left;
    }

    .widget {
      background:white;
      padding:15px;
      border-radius:10px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
      font-size:16px;
    }

    /* Floating Donate */
    .donate-float {
      position:fixed;
      top:15px;
      right:15px;
      z-index:9999;
      background:#e91e63;
      color:#fff;
      padding:10px 16px;
      border-radius:20px;
      font-size:15px;
      text-decoration:none;
      box-shadow:0 4px 10px rgba(0,0,0,0.25);
    }
    .donate-float:hover { background:#c2185b; }
  </style>
</head>

<body>

<a href="https://buymeacoffee.com/YOURNAME" target="_blank" class="donate-float">
  ЁЯТЦ Donate
</a>

<h1>роЪрпКро▓рпН роЕроХро░ро╛родро┐</h1>
<p>родрооро┐ро┤рпН ро╡ро╛ро┤рпНроХ, ро╡ро│ро░рпНроХ, ро╡рпЖро▓рпНроХ</p>

<div class="search-area">
  <input id="word" placeholder="родрооро┐ро┤рпНроЪрпН роЪрпКро▓рпН / English word" />
  <div id="suggestions"></div>
  <br><br>
  <button onclick="searchWord()">родрпЗроЯрпБ</button>
</div>

<div class="main">
  <div class="left-pane">
    <h3>родрпКроЯро░рпНрокрпБроЯрпИроп родроХро╡ро▓рпН</h3>
    <div class="match-item">Canonical lemma</div>
    <div class="match-item">Derived forms</div>
    <div class="match-item">Variants</div>
    <div class="match-item">Evidence sources</div>
  </div>

  <div class="right-pane" id="result"></div>
</div>

<!-- ЁЯФ╜ Widgets Section -->
<div class="widgets">
  <div class="widget" id="wordOfDay">
    <b>роЗройрпНро▒рпИроп роЪрпКро▓рпН</b><br>роПро▒рпНро▒рпБроХро┐ро▒родрпБ...
  </div>

  <div class="widget" id="scholarBox">
    <b>роЗройрпНро▒рпИроп родрооро┐ро┤рпН роЕро▒ро┐роЮро░рпН</b><br>роПро▒рпНро▒рпБроХро┐ро▒родрпБ...
  </div>

  <div class="widget">
    <b>роЗроирпНрод роорпБропро▒рпНроЪро┐ропрпИ роЖродро░ро┐роХрпНроХ</b><br>
    родрооро┐ро┤рпН роорпКро┤ро┐роХрпНроХро╛рой роЗроирпНрод роЕроХро░ро╛родро┐ропрпИ ро╡ро│ро░рпНроХрпНроХ роЙроЩрпНроХро│рпН роЙродро╡ро┐ родрпЗро╡рпИ.<br>
    <a href="https://buymeacoffee.com/YOURNAME" target="_blank">Donate</a>
  </div>
</div>

<script>
/* ---------- Search Logic (UNCHANGED) ---------- */
async function searchWord() {
  const q = word.value.trim();
  const resultBox = document.getElementById("result");
  resultBox.innerHTML = "";

  if (!q) {
    resultBox.innerHTML = `<div class="box">роТро░рпБ роЪрпКро▓рпН роЙро│рпНро│ро┐роЯрпБроЩрпНроХро│рпН.</div>`;
    return;
  }

  resultBox.innerHTML = `<div class="box">роЪрпЖропро▓ро╛роХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ...</div>`;

  try {
    const res = await fetch("https://sollagarathi-backend.onrender.com/resolve",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ query:q })
    });

    const data = await res.json();
    resultBox.innerHTML = "";

    if (data.stage==="choose") {
      resultBox.innerHTML = `
        <div class="box">
          <div class="title">родрооро┐ро┤рпНроЪрпН роЪроорооро╛рой роЪрпКро▒рпНроХро│рпН</div>
          ${data.options.map(w=>`<button onclick="finalizeWord('${w}')">${w}</button>`).join(" ")}
        </div>`;
      return;
    }

    if (data.stage==="entry") {
      resultBox.innerHTML += `
        <div class="box">
          <div class="title">${data.lemma}</div>
          ${data.entry}
        </div>`;
    }

    const m = await fetch("https://sollagarathi-backend.onrender.com/search/"+encodeURIComponent(q));
    const md = await m.json();
    md.results?.forEach(r=>{
      resultBox.innerHTML += `
        <div class="box">
          <div class="title">${r.source}</div>
          ${r.text}
        </div>`;
    });

  } catch {
    resultBox.innerHTML = `<div class="box">роЪро░рпНро╡ро░рпИ роЕрогрпБроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ.</div>`;
  }
}

async function finalizeWord(w) {
  const r = await fetch("https://sollagarathi-backend.onrender.com/finalize",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ word:w })
  });
  const d = await r.json();
  result.innerHTML = `<div class="box"><div class="title">${d.lemma}</div>${d.entry}</div>`;
}

word.addEventListener("keydown",e=>{ if(e.key==="Enter") searchWord(); });

function isTamil(t){ return /[\u0B80-\u0BFF]/.test(t); }

word.addEventListener("input",async()=>{
  suggestions.innerHTML="";
  if(!word.value || isTamil(word.value)) return;
  const r = await fetch("https://sollagarathi-backend.onrender.com/transliterate",{
    method:"POST", headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ text:word.value })
  });
  const j = await r.json();
  suggestions.innerHTML = (j.options||[]).map(o=>`<span onclick="word.value='${o}';suggestions.innerHTML=''">${o}</span>`).join("");
});

/* ---------- Widgets ---------- */
fetch("https://sollagarathi-backend.onrender.com/word-of-the-day")
  .then(r=>r.json())
  .then(d=>{
    if(d?.tamil_word)
      wordOfDay.innerHTML = `<b>роЗройрпНро▒рпИроп роЪрпКро▓рпН</b><br>${d.tamil_word}`;
  });

const scholars=[
"роЙ. ро╡рпЗ. роЪро╛рооро┐роиро╛родрпИропро░рпН","рооро▒рпИрооро▓рпИ роЕроЯро┐роХро│рпН","роЪро┐. ро╡рпИ. родро╛роорпЛродро░роорпН рокро┐ро│рпНро│рпИ",
"роЖро▒рпБроорпБроХ роиро╛ро╡ро▓ро░рпН","родрпЗро╡роирпЗропрокрпН рокро╛ро╡ро╛рогро░рпН","роорпБ. ро╡ро░родро░ро╛роЪройро╛ро░рпН"
];
const s=scholars[Math.floor(Math.random()*scholars.length)];
fetch(`https://ta.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts|info&inprop=url&exintro=1&explaintext=1&titles=${encodeURIComponent(s)}`)
.then(r=>r.json()).then(j=>{
  const p=j.query.pages[Object.keys(j.query.pages)[0]];
  scholarBox.innerHTML = `<b>${s}</b><br>${p?.extract?.substring(0,300) || "ро╡ро┐ро╡ро░роорпН роЗро▓рпНро▓рпИ"}...`;
});
</script>

</body>
</html>
